<!DOCTYPE html>
<html lang = "en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <link rel="stylesheet" href="style.css">
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link rel="stylesheet" href="croppie.css" />
  <script src="croppie.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Marcellus+SC&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300&display=swap" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="180x180" href="Images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="Images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="Images/favicon-16x16.png">
  <link rel="manifest" href="Images/site.webmanifest">
  <title>Rkhive Mass Academy</title>
  </head>
  <style>
  ul {
    list-style-type: none;
  }
  .personDesc{
    text-align: center;
    padding: 0px;
  }
  th{
    text-align: center;
  }
  .entry{
    border-width: 2px;
    border-style: solid;
  }
  </style>
  <body>
    <nav class="navbar navbar-default">
      <div class="container-fluid">
        <div class="navbar-header">
          <div id="img">
          <span class="white"><a class="navbar-brand active" href="index.html"><img style="display:block" src="Images/CornerLogoV2.png" height="55px"></a></span>
          </div>
        </div>
        <ul class="nav navbar-nav">
          <li><a href="rkhive.html">MAMS Rkhive</a></li>
          <li><a href="about.html">About Rkhive</a></li>
          <!-- <li><a href="imageUpload.html">Upload Images</a></li> -->
          <li><a href="login.html">Log in</a></li>
        </ul>
      </div>
    </nav>
      <div class="center heading-gap">
      <div>
      <progress id="uploader" value="0" max="100"> 0% </progress>
      <br>
      <input id = 'fileButton' type = 'file' value = 'upload' style = "display:none"></input>
      <label for="fname">First name:</label>
      <input type="text" id="fname" name="fname"><br><br>
      <label for="lname">Last name:</label>
      <input type="text" id="lname" name="lname"><br><br>
      <input type="submit" onclick = "printNames();">
      <br>
      <br>
      <p id = progressPrint></p>
      <img class = 'gridImg' src = "" id = "myimg" style = "display:none"></img>
    </div>
      <!-- The core Firebase JS SDK is always required and must be listed first -->
      <script src="https://www.gstatic.com/firebasejs/8.3.2/firebase-app.js"></script>
      <script src="https://www.gstatic.com/firebasejs/8.3.2/firebase-database.js"></script>

      <!-- TODO: Add SDKs for Firebase products that you want to use
           https://firebase.google.com/docs/web/setup#available-libraries -->
      <script src="https://www.gstatic.com/firebasejs/8.3.2/firebase-analytics.js"></script>
      <script src="https://www.gstatic.com/firebasejs/8.3.2/firebase-storage.js"></script>
      <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
      <script>
        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        var firebaseConfig = {
          apiKey: "AIzaSyA-7xOhqPJjhq-cm6VuzjZZ5X3dti6UeFQ",
          authDomain: "rkhive-1faec.firebaseapp.com",
          databaseURL: "https://rkhive-1faec-default-rtdb.firebaseio.com",
          projectId: "rkhive-1faec",
          storageBucket: "rkhive-1faec.appspot.com",
          messagingSenderId: "608713408633",
          appId: "1:608713408633:web:fe413d775d51be77e2d4a8",
          measurementId: "G-PCS017396G"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        firebase.analytics();

        //get elements
        var uploader = document.getElementById('uploader');
        var fileButton = document.getElementById('fileButton');
        var fname = "";
        var lname = "";
        function printNames(){
          fname = document.getElementById('fname').value;
          lname = document.getElementById('lname').value;
          email = document.getElementById('email').value;
          console.log(fname+" "+lname);
          firebase.storage().ref('yb_photos/'+fname+"_"+lname+".png").getDownloadURL()
              .then((url) => {

                // Or inserted into an <img> element
                var img = document.getElementById('myimg');
                img.setAttribute('src', url);
              })
              .catch((error) => {
                // Handle any errors
              });
          document.getElementById("fileButton").style.display = "block";
          document.getElementById("myimg").style.display = "block";
        }

        function showInputs(){
          document.getElementById('lname').display = "";
          $(progressPrint).html("Upload Complete!");
        }

        //listen for file selection
        fileButton.addEventListener('change', function(e) {
            //get file
            console.log(fname + lname);
            var file = e.target.files[0];
            console.log(file);
            var blob = file.slice(0, file.size, 'image/png/jpg/jpeg');
            newFile = new File([blob], fname+'_'+lname+".png", {type: 'image/png'});

            //create storage refresh
            //originally file.name
            var storageRef = firebase.storage().ref('yb_photos/'+newFile.name);

            //upload file
            //originally file
            var task = storageRef.put(newFile);

            //update progress banner
            task.on('state_changed',

            function progress (snapshot){
              var percentage = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
              uploader.value = percentage;
            },

            function error(err) {

            },

            function complete(){
              showInputs();
            }
          );
        });
      </script>

  </body>

  <script src = "./functions.js"></script>

  </html>
